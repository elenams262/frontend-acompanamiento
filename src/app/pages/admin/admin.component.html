@if (!isLoggedIn) {
  <div class="login-container">
    <h2>Acceso Administrador</h2>
    <form
      (ngSubmit)="login()"
      style="display: flex; flex-direction: column; gap: 1rem; margin-top: 1.5rem"
    >
      <div>
        <input
          type="text"
          [(ngModel)]="loginData.username"
          name="username"
          placeholder="Usuario"
          required
          style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px"
        />
      </div>
      <div>
        <input
          type="password"
          [(ngModel)]="loginData.password"
          name="password"
          placeholder="Contraseña"
          required
          style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px"
        />
      </div>
      <button type="submit" class="btn" style="width: 100%; margin-top: 1rem">Entrar</button>
    </form>
  </div>
} @else {
  <div class="container" style="padding: 2rem 1rem">
    <div class="admin-header">
      <h2 style="margin: 0">Panel de Administración</h2>
      <button
        (click)="logout()"
        class="btn"
        style="background: #e53935; padding: 0.5rem 1rem; font-size: 0.9rem"
      >
        Cerrar Sesión
      </button>
    </div>

    <div class="admin-grid">
      <!-- Formulario de Creación / Edición -->
      <div>
        <form (ngSubmit)="savePost()" class="card">
          <h3>{{ editingPostId ? 'Editar Publicación' : 'Publicar en el Blog' }}</h3>

          <div style="margin-bottom: 1rem">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: bold">Título</label>
            <input
              type="text"
              [(ngModel)]="newPost.title"
              name="title"
              required
              style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px"
            />
          </div>

          <div style="margin-bottom: 1rem">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: bold">Imagen</label>
            <input
              type="file"
              accept="image/*"
              (change)="handleImageUpload($event)"
              [required]="!editingPostId && !newPost.imageUrl"
              style="
                width: 100%;
                padding: 0.75rem;
                border: 1px solid #ddd;
                border-radius: 4px;
                background: white;
              "
            />
            @if (newPost.imageUrl) {
              <div style="margin-top: 1rem; text-align: center">
                <img
                  [src]="newPost.imageUrl"
                  style="
                    max-height: 200px;
                    max-width: 100%;
                    border-radius: 4px;
                    object-fit: contain;
                  "
                  alt="Vista previa"
                />
              </div>
            }
          </div>

          <div style="margin-bottom: 1rem">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: bold"
              >Contenido (Texto)</label
            >
            <textarea
              [(ngModel)]="newPost.content"
              name="content"
              rows="8"
              required
              style="
                width: 100%;
                padding: 0.75rem;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-family: inherit;
              "
            ></textarea>
          </div>

          <div class="btn-form-group">
            <button
              type="submit"
              [disabled]="isSubmitting"
              class="btn"
              style="flex: 1; font-size: 1.1rem; padding: 1rem"
            >
              {{
                editingPostId
                  ? isSubmitting
                    ? 'Guardando...'
                    : 'Guardar Cambios'
                  : isSubmitting
                    ? 'Publicando...'
                    : 'Publicar Artículo'
              }}
            </button>
            @if (editingPostId) {
              <button
                type="button"
                [disabled]="isSubmitting"
                (click)="cancelEdit()"
                class="btn"
                style="flex: 1; font-size: 1.1rem; padding: 1rem; background: #666"
              >
                Cancelar
              </button>
            }
          </div>
        </form>
      </div>

      <!-- Lista de Publicaciones -->
      <div>
        <h3>Publicaciones Activas</h3>
        @if (blogService.posts().length === 0) {
          <p>No hay publicaciones.</p>
        }

        @for (post of blogService.posts(); track post.id) {
          <div class="card list-item-card">
            <div style="flex: 1">
              <span style="font-weight: bold; display: block">{{ post.title }}</span>
              <small style="color: grey">{{ post.date | date: 'shortDate' }}</small>
            </div>
            <div class="list-item-actions">
              <button
                (click)="editPost(post)"
                style="
                  background: #2196f3;
                  color: white;
                  border: none;
                  padding: 0.5rem 1rem;
                  border-radius: 4px;
                  cursor: pointer;
                "
              >
                Editar
              </button>
              <button
                (click)="blogService.deletePost(post.id)"
                style="
                  background: #e53935;
                  color: white;
                  border: none;
                  padding: 0.5rem 1rem;
                  border-radius: 4px;
                  cursor: pointer;
                "
              >
                Eliminar
              </button>
            </div>
          </div>
        }
      </div>
    </div>

    <!-- Sección de Mensajes de Contacto -->
    <div style="margin-top: 3rem">
      <h3 style="margin-bottom: 1.5rem; text-align: center; color: var(--primary)">
        Mensajes de Contacto
      </h3>
      @if (contactService.contacts().length === 0) {
        <p style="text-align: center; color: #666">No hay mensajes de contacto.</p>
      }

      <div style="display: flex; flex-direction: column; gap: 1rem">
        @for (contact of contactService.contacts(); track contact.id) {
          <div
            class="card"
            style="
              padding: 1.5rem;
              display: flex;
              flex-direction: column;
              gap: 0.5rem;
              border-left: 4px solid var(--primary);
            "
          >
            <div class="card-header">
              <div>
                <strong>{{ contact.name }}</strong>
                <span class="contact-info-span">
                  <a [href]="'mailto:' + contact.email" style="color: var(--primary)">{{
                    contact.email
                  }}</a>
                  |
                  <a [href]="'tel:' + contact.phone" style="color: var(--primary)">{{
                    contact.phone
                  }}</a>
                </span>
              </div>
              <small style="color: #999">{{ contact.date | date: 'short' }}</small>
            </div>

            <div style="margin-top: 0.5rem">
              <strong style="color: #444">Asunto:</strong> {{ contact.subject }}
            </div>

            <div
              style="
                background: #fdfdfd;
                padding: 1rem;
                border-radius: 4px;
                border: 1px solid #eee;
                margin-top: 0.5rem;
                white-space: pre-wrap;
              "
            >
              {{ contact.message }}
            </div>

            <div style="display: flex; justify-content: flex-end; margin-top: 1rem">
              <button
                (click)="contactService.deleteContact(contact.id!)"
                style="
                  background: #e53935;
                  color: white;
                  border: none;
                  padding: 0.5rem 1rem;
                  border-radius: 4px;
                  cursor: pointer;
                  font-size: 0.9em;
                "
              >
                Eliminar Mensaje
              </button>
            </div>
          </div>
        }
      </div>
    </div>

    <!-- Sección de Reseñas de Usuarios -->
    <div style="margin-top: 3rem; border-top: 2px solid #eee; padding-top: 2rem">
      <h3 style="margin-bottom: 1.5rem; text-align: center; color: var(--primary)">
        Gestión de Reseñas (Testimonios)
      </h3>
      @if (testimonials.length === 0) {
        <p style="text-align: center; color: #666">No hay reseñas por el momento.</p>
      }

      <div style="display: flex; flex-direction: column; gap: 1rem">
        @for (testimo of testimonials; track testimo.id) {
          <div
            class="card"
            style="
              padding: 1.5rem;
              display: flex;
              flex-direction: column;
              gap: 0.5rem;
              border-left: 4px solid var(--primary);
            "
          >
            <div class="card-header">
              <div>
                <strong>{{ testimo.name }}</strong>
              </div>
              <small style="color: #999">{{ testimo.date | date: 'short' }}</small>
            </div>

            <div
              style="
                background: #fdfdfd;
                padding: 1rem;
                border-radius: 4px;
                border: 1px solid #eee;
                margin-top: 0.5rem;
                white-space: pre-wrap;
                font-style: italic;
              "
            >
              "{{ testimo.text }}"
            </div>

            <div style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1rem">
              <!-- Toggle button removed -->
              <button
                (click)="deleteTestimonial(testimo.id)"
                style="
                  background: #e53935;
                  color: white;
                  border: none;
                  padding: 0.5rem 1rem;
                  border-radius: 4px;
                  cursor: pointer;
                  font-size: 0.9em;
                "
              >
                Eliminar
              </button>
            </div>
          </div>
        }
      </div>
    </div>
  </div>
}
